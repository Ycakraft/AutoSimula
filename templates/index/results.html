{% extends 'layout.html' %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 

<style>
/* ===== VARIÁVEIS CSS (CUSTOM PROPERTIES) ===== */
:root {
    --ferrari-red: #ff2800;
    --ferrari-black: #000000;
    --ferrari-white: #ffffff;
    --ferrari-gray: #d9d9d9;
    --ferrari-dark: #1a1a1a;
    --transition: all 0.3s ease;
}

/* ===== RESET E CONFIGURAÇÕES GERAIS ===== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Montserrat', sans-serif;
}

body {
    background-color: var(--ferrari-black);
    color: var(--ferrari-white);
    line-height: 1.6;
    overflow-x: hidden;
    font-weight: 400;
}

/* ===== TIPOGRAFIA ===== */
h1, h2, h3, h4, h5 {
    font-family: 'Oswald', sans-serif;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.5px;
}

/* ===== LAYOUT E CONTAINERS ===== */
.container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.page {
    display: none;
    min-height: 100vh;
}

.page.active {
    display: block;
}

.full-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    padding: 100px 0;
    position: relative;
    overflow: hidden;
}

/* ===== HEADER E NAVEGAÇÃO (MANTIDO) ===== */
header {
    position: fixed;
    top: 1rem;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 1200px;
    min-width: 600px;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
    background-color: rgba(121, 121, 121, 0.434);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo-text {
    font-family: 'Oswald', sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--ferrari-red);
    text-transform: uppercase;
}

.nav-links {
    display: flex;
    gap: 30px;
}

.nav-links a {
    color: var(--ferrari-white);
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition);
    position: relative;
    text-transform: uppercase;
    font-size: 0.9rem;
    letter-spacing: 0.5px;
}

.nav-links a:hover {
    color: var(--ferrari-white);
}

.nav-links a::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--ferrari-red);
    transition: var(--transition);
}

.nav-links a:hover::after {
    width: 100%;
}

/* Estilos de HERO, QUESTIONNAIRE e FORMULÁRIO removidos */

/* ===== SEÇÃO PADRÃO (USADA NO RESULTS) ===== */
.section-title {
    text-align: center;
    margin-bottom: 80px;
    position: relative;
}

.section-title h2 {
    font-size: 2.8rem;
    color: var(--ferrari-white);
    margin-bottom: 20px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.section-title p {
    color: var(--ferrari-gray);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

.section-title::after {
    content: '';
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 4px;
    background: var(--ferrari-red);
    border-radius: 2px;
}

/* ===== BOTÃO CTA (USADO NO FINAL DO RESULTS) ===== */
.cta-button {
    display: inline-block;
    padding: 15px 40px;
    background-color: var(--ferrari-red); /* Padrão do botão CTA no Results */
    color: var(--ferrari-white);
    border: 2px solid var(--ferrari-red); 
    border-radius: 12px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.cta-button:hover {
    background-color: transparent;
    color: var(--ferrari-red);
    transform: translateY(-2px);
    box-shadow: 0 0 10px rgba(255, 40, 0, 0.5); 
}


/* ===== RESULTS PAGE (PÁGINA DE RESULTADOS) - COMPLETO ===== */
.results {
    background: linear-gradient(rgba(10, 10, 10, 0.95), rgba(20, 20, 20, 0.98));
    padding: 100px 0;
}

.dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-bottom: 50px;
}

.dashboard-card {
    background-color: rgba(30, 30, 30, 0.9);
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(100, 100, 100, 0.2);
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.dashboard-card:hover {
    transform: translateY(-5px);
    border-color: rgba(150, 150, 150, 0.4);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
}

.dashboard-card h3 {
    color: var(--ferrari-white);
    margin-bottom: 20px;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    border-bottom: 1px solid rgba(100, 100, 100, 0.3);
    padding-bottom: 15px;
}

.dashboard-card h3 i {
    font-size: 1.6rem;
    color: var(--ferrari-gray);
}

/* ===== GRÁFICOS E DADOS FINANCEIROS ===== */
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-top: 50px;
}

.chart-card {
    background-color: rgba(30, 30, 30, 0.9);
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(100, 100, 100, 0.2);
    backdrop-filter: blur(10px);
}

.chart-title {
    color: var(--ferrari-red);
    font-family: 'Oswald', sans-serif;
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 1px;
    margin-bottom: 15px;
    text-align: center;
}

.chart-wrapper {
    height: 250px;
    position: relative;
}

.financial-data {
    margin-top: 15px;
}

.data-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(100, 100, 100, 0.2);
}

.data-row:last-child {
    border-bottom: none;
}

.data-label {
    color: var(--ferrari-gray);
}

.data-value {
    color: var(--ferrari-white);
    font-weight: 600;
}

.highlight {
    color: var(--ferrari-red);
    font-weight: 700;
}

/* Estilos de About e Footer removidos por não serem usados na seção body atual. */


/* ===== RESPONSIVIDADE ===== */
@media (max-width: 768px) {
    header {
        min-width: unset;
        width: 95%;
        padding: 1rem;
    }
    
    .nav-links {
        gap: 15px;
    }
    
    .logo-text {
        font-size: 1.4rem;
    }
    
    .section-title h2 {
        font-size: 2.2rem;
    }

    .dashboard, .charts-container {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block body %}
    <section id="results" class="page active">
        <div class="full-screen results">
            <div class="container">
                <div class="section-title">
                    <h2>Resultado da Simulação</h2>
                    <p>Análise baseada em seus dados e nas melhores opções do mercado</p>
                </div>

                                <div id="cash-result">
                    <div class="dashboard">
                        <div class="dashboard-card">
                            <h3><i class="fas fa-money-bill-wave"></i> Resumo do Pagamento à Vista</h3>
                            <div class="financial-data">
                                <div class="data-row">
                                    <span class="data-label">Valor total do veículo:</span>
                                    <span class="data-value" id="cash-total">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Possível desconto:</span>
                                    <span class="data-value" id="cash-discount">R$ 0,00</span>
                                </div>
                                <div class="data-row" id="tradein-section" style="display: none;">
                                    <span class="data-label">Valor de troca:</span>
                                    <span class="data-value" id="tradein-value">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Valor final:</span>
                                    <span class="data-value highlight" id="cash-final">R$ 0,00</span>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <h3><i class="fas fa-car"></i> Carro Sugerido</h3>
                            <div class="financial-data">
                                <div class="data-row">
                                    <span class="data-label">Modelo:</span>
                                    <span class="data-value" id="result-car-model">-</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Preço:</span>
                                    <span class="data-value" id="result-car-price">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Opcionais:</span>
                                    <span class="data-value" id="result-car-options">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                                <div id="financing-result" style="display: none;">
                    <div class="dashboard">
                        <div class="dashboard-card">
                            <h3><i class="fas fa-chart-line"></i> Resumo do Financiamento</h3>
                            <div class="financial-data">
                                <div class="data-row">
                                    <span class="data-label">Valor total do veículo:</span>
                                    <span class="data-value" id="financing-total">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Entrada:</span>
                                    <span class="data-value" id="financing-downpayment">R$ 0,00</span>
                                </div>
                                <div class="data-row" id="financing-tradein-section" style="display: none;">
                                    <span class="data-label">Valor de troca:</span>
                                    <span class="data-value" id="financing-tradein-value">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Valor financiado:</span>
                                    <span class="data-value" id="financing-amount">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Parcelas:</span>
                                    <span class="data-value" id="financing-installments">0x</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Valor da parcela:</span>
                                    <span class="data-value highlight" id="financing-monthly">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Total a pagar:</span>
                                    <span class="data-value" id="financing-totalpaid">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Juros totais:</span>
                                    <span class="data-value" id="financing-interest">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Percentual:</span>
                                    <span class="data-value" id="financing-percentage">0% financiado</span>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <h3><i class="fas fa-car"></i> Carro Sugerido</h3>
                            <div class="financial-data">
                                <div class="data-row">
                                    <span class="data-label">Modelo:</span>
                                    <span class="data-value" id="financing-car-model">-</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Preço:</span>
                                    <span class="data-value" id="financing-car-price">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Opcionais:</span>
                                    <span class="data-value" id="financing-car-options">-</span>
                                </div>
                            </div>

                            <h3><i class="fas fa-chart-pie"></i> Composição do Financiamento</h3>
                            <div class="chart-container">
                                <canvas id="financingChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard">
                        <div class="dashboard-card">
                            <h3><i class="fas fa-chart-bar"></i> Comparação Mensal</h3>
                            <div class="chart-container">
                                <canvas id="comparisonChart"></canvas>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <h3><i class="fas fa-check-circle"></i> Recomendação</h3>
                            <p id="recommendation-text">Com base na sua renda e perfil, a troca é vantajosa
                                financeiramente.</p>
                            <div class="financial-data">
                                <div class="data-row">
                                    <span class="data-label">Economia mensal estimada:</span>
                                    <span class="data-value highlight" id="monthly-savings">R$ 0,00</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label">Prazo ideal para compra:</span>
                                    <span class="data-value" id="ideal-purchase-time">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

    <div class="charts-container">
                <div class="chart-card">
            <div class="chart-title">COMPARAÇÃO DE PREÇOS</div>
            <div class="chart-wrapper">
                <canvas id="priceChart"></canvas>
            </div>
        </div>

                <div class="chart-card">
            <div class="chart-title">CUSTO TOTAL (5 ANOS)</div>
            <div class="chart-wrapper">
                <canvas id="costChart"></canvas>
            </div>
        </div>

                <div class="chart-card">
            <div class="chart-title">MANUTENÇÃO ANUAL</div>
            <div class="chart-wrapper">
                <canvas id="maintenanceChart"></canvas>
            </div>
        </div>

                <div class="chart-card">
            <div class="chart-title">DESVALORIZAÇÃO EM 3 ANOS</div>
            <div class="chart-wrapper">
                <canvas id="depreciationChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // O script de inicialização do Chart.js foi movido para o final do body para garantir que os elementos <canvas> existam antes de serem manipulados.

        // Gráfico 1: Comparação de Preços
        const priceCtx = document.getElementById('priceChart').getContext('2d');
        new Chart(priceCtx, {
            type: 'bar',
            data: {
                labels: ['Sugerido', 'Opção B', 'Opção C', 'Opção D'],
                datasets: [{
                    label: 'Preço (R$)',
                    data: [125990, 142500, 138000, 131750],
                    backgroundColor: [
                        'rgba(52, 152, 219, 0.8)',
                        'rgba(149, 165, 166, 0.6)',
                        'rgba(149, 165, 166, 0.6)',
                        'rgba(149, 165, 166, 0.6)'
                    ],
                    borderColor: [
                        'rgba(52, 152, 219, 1)',
                        'rgba(149, 165, 166, 1)',
                        'rgba(149, 165, 166, 1)',
                        'rgba(149, 165, 166, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'R$ ' + context.parsed.y.toLocaleString('pt-BR');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + (value / 1000).toFixed(0) + ' mil';
                            }
                        }
                    }
                }
            }
        });

        // Gráfico 2: Custo Total 5 Anos
        const costCtx = document.getElementById('costChart').getContext('2d');
        new Chart(costCtx, {
            type: 'bar',
            data: {
                labels: ['Sugerido', 'Opção B', 'Opção C'],
                datasets: [{
                    label: 'Custo Total (R$)',
                    data: [185000, 210000, 195000],
                    backgroundColor: [
                        'rgba(46, 204, 113, 0.8)',
                        'rgba(149, 165, 166, 0.6)',
                        'rgba(149, 165, 166, 0.6)'
                    ],
                    borderColor: [
                        'rgba(46, 204, 113, 1)',
                        'rgba(149, 165, 166, 1)',
                        'rgba(149, 165, 166, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'R$ ' + context.parsed.y.toLocaleString('pt-BR');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + (value / 1000).toFixed(0) + ' mil';
                            }
                        }
                    }
                }
            }
        });

        // Gráfico 3: Manutenção Anual
        const maintenanceCtx = document.getElementById('maintenanceChart').getContext('2d');
        new Chart(maintenanceCtx, {
            type: 'line',
            data: {
                labels: ['1º Ano', '2º Ano', '3º Ano', '4º Ano', '5º Ano'],
                datasets: [{
                    label: 'Sugerido',
                    data: [1200, 1500, 1800, 2200, 2500],
                    borderColor: 'rgba(52, 152, 219, 1)',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Média Mercado',
                    data: [1500, 1900, 2300, 2800, 3200],
                    borderColor: 'rgba(149, 165, 166, 1)',
                    backgroundColor: 'rgba(149, 165, 166, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    borderDash: [5, 5]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return 'R$ ' + value.toLocaleString('pt-BR');
                            }
                        }
                    }
                }
            }
        });

        // Gráfico 4: Desvalorização
        const depreciationCtx = document.getElementById('depreciationChart').getContext('2d');
        new Chart(depreciationCtx, {
            type: 'doughnut',
            data: {
                labels: ['Valor Residual', 'Desvalorização'],
                datasets: [{
                    data: [65, 35],
                    backgroundColor: [
                        'rgba(46, 204, 113, 0.8)',
                        'rgba(231, 76, 60, 0.8)'
                    ],
                    borderColor: [
                        'rgba(46, 204, 113, 1)',
                        'rgba(231, 76, 60, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                },
                cutout: '60%'
            }
        });
        
        // --- Início do bloco de script de navegação (Não é usado na página de resultados, mas mantido para integridade) ---
        document.addEventListener('DOMContentLoaded', function () {
            // Variáveis e funções de navegação entre etapas (step1, step2) e páginas (questionnaire, results)
            // Mantidas para evitar erros de referência se as outras páginas forem carregadas.

            // Configuração de navegação entre páginas principais
            const navLinks = document.querySelectorAll('.nav-links a, .cta-button');
            const pages = document.querySelectorAll('.page');

            navLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetPage = this.getAttribute('data-page');

                    if (targetPage) {
                        pages.forEach(page => {
                            page.classList.remove('active');
                        });

                        document.getElementById(targetPage).classList.add('active');
                        window.scrollTo(0, 0);
                        
                        // Lógica de reset (mantida em comentários para evitar falha se elementos não existirem)
                        /* if (targetPage === 'questionnaire') {
                            if (typeof goToStep === 'function') goToStep(1);
                        } 
                        */
                    }
                });
            });
            
            // --- Funções de simulação/preenchimento (A função calculateSimulation foi removida, mas o preenchimento de dados foi mantido
            // para que a página exiba dados se for a página ativa na carga inicial) ---

            document.getElementById('cash-total').textContent = 'R$ 75.000,00';
            document.getElementById('cash-discount').textContent = 'R$ 3.750,00';
            document.getElementById('cash-final').textContent = 'R$ 71.250,00';
            document.getElementById('result-car-model').textContent = 'Volkswagen Golf 2023';
            document.getElementById('result-car-price').textContent = 'R$ 75.000,00';
            document.getElementById('result-car-options').textContent = 'Automático, Ar-condicionado, Multimídia';

            document.getElementById('financing-total').textContent = 'R$ 75.000,00';
            document.getElementById('financing-downpayment').textContent = 'R$ 15.000,00';
            document.getElementById('financing-amount').textContent = 'R$ 60.000,00';
            document.getElementById('financing-installments').textContent = '48x';
            document.getElementById('financing-monthly').textContent = 'R$ 1.450,00';
            document.getElementById('financing-totalpaid').textContent = 'R$ 84.600,00';
            document.getElementById('financing-interest').textContent = 'R$ 9.600,00';
            document.getElementById('financing-percentage').textContent = '80% financiado, 20% entrada';
            document.getElementById('financing-car-model').textContent = 'Volkswagen Golf 2023';
            document.getElementById('financing-car-price').textContent = 'R$ 75.000,00';
            document.getElementById('financing-car-options').textContent = 'Automático, Ar-condicionado, Multimídia';
            document.getElementById('monthly-savings').textContent = 'R$ 250,00';
            document.getElementById('ideal-purchase-time').textContent = '3 meses';
            
            // Oculta o resultado de financiamento por padrão (já estava no HTML, mas reconfirma)
            document.getElementById('financing-result').style.display = 'none';
        });
    </script>

{% endblock %}